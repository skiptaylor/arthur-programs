<script src="/js/scenario.js"></script>

<div class="container">

<ul class="breadcrumb">
	<li>NCMHCE CEU<span class="divider">/</span></li>
	<li><a href="/ceu/scenarios">Scenarios</a> <span class="divider">/</span></li>
	<li class="active"><%= @scenario.title %></li>
</ul>


<div class="page-header">
	<h1><%= @scenario.id %>. <%= @scenario.title %></h1>
</div>

<% if @average %>
	<div class="well">
		<div class="row">
			<div class="span11">
				<h3>
					Your Score: <%= @average %>% &nbsp; <% unless @average < 70 %><span style="color: #009c23;">Congratulations! You Passed.</span><% end %>
				</h3>
				<%
					style = 'bar-warning' if @average < 70
					style = 'bar-success' if @average >= 70
				%>
				<div class="progress">
					<div class="bar  <%= style %>" style="width: <%= @average %>%;"></div>
				</div>
			</div>
		</div>
		
		
		<div class="row">
			<h3><%= erb :progressbar_ceu, layout: false, locals: { label: 'Information Gathering', correct: @breakdown['Information Gathering'][:correct], possible: @breakdown['Information Gathering'][:possible] } %></h3>	
			<h3><%= erb :progressbar_ceu, layout: false, locals: { offset: true, label: 'Decision Making', correct: @breakdown['Decision Making'][:correct], possible: @breakdown['Decision Making'][:possible] } %></h3>
		</div>
		
		<% unless @average > 69 %>
		<br />
		<a href="/ceu/scenarios/<%= params[:id] %>/restart" class="btn btn-primary restart">Start Over</a>
		<br /><br />
		<strong>
			<span style="color: #666666; font-size: 90%;">Answers are highlighted as follows:</span> &nbsp;
			<span class="badge" style="color: white; background-color: green;">Correct</span> &nbsp;
			<span class="badge" style="color: white; background-color: red;">Incorrect</span> &nbsp;
			<span class="badge" style="color: white; background-color: blue;">No Value</span> &nbsp;
			<span class="badge" style="color: white; background-color: #777777;">Not Chosen</span>
		</strong>
		<% end %>
	</div>
	
	<% end %>
			
	<% if @average && @average > 69 %>
	
	<!-- <ul id="myTab" class="nav nav-pills">
		<li class="active"><a href="#certificate" data-toggle="pill">Get My Certificate</a></li>
		<li><a href="#test" data-toggle="pill">View Scenario</a></li>
	</ul>
	<hr /> -->
	<div id="myTabContent" class="tab-content">
		<div class="tab-pane active" id="certificate">
			<% @user = User.get session[:user] %>
			<div class="row">
				<div class="span12">
					<h3>
						<img src="/img/check.png" class="pull-left" style="margin: 0.3em 1em 1em 0;" />You have passed CEU Scenario <%= @scenario.id %>.
					</h3>
					<p>Please review your account information and submit to receive your certificate.</p>
					<br />
					<div class="span9 offset1">
					<address>
					  <strong><%= @user.name %></strong><br>
					  <%= @user.email %><br>
					  <%= @user.phone %><br><br>
					  <% if @user.license %><strong>License:</strong> <%= @user.license %></small><% end %>
					</address>
					<p><!-- <a href="#" class="btn btn-default">Edit</a> &nbsp;  --><a href="#" data-toggle="pill" class="btn btn-success">Submit</a></p>
					<p><small>You cannot retake this exam after getting a passing score.<br />
						<strong>NOTE:</strong> If your account information is incorrect please call 888-326-9229 before submitting your certificate.</small></p>
				</div>
				</div>
			</div>
		</div>

		<div class="tab-pane fade" id="test">
			<%= markdown @scenario.body %>
			<hr />
			<% @questions.each do |question| %>
			<div class="question" id="question-<%= question.position %>" style="<%= hidden unless @average || question.position == 1 %>">
				<p><strong><%= question.position %>. <%= question.body %></strong></p>
				<% answers = @answers.find_all {|a| a.question_id == question.id } %>
				<form>
					<% answers.each do |answer| %>
						<%
							if answer.value > 0
								style = 'correct'
							elsif answer.value < 0
								style = 'incorrect'
							elsif answer.value == 0
								style = 'neutral'
							else
								style = ''
							end
						%>
				<label class="checkbox <%= style if @average && @scores.include?(answer.id) %>">
					<input type="checkbox" class="<%= 'required' if answer.required? %>" id="<%= answer.id %>" name="<%= answer.id %>" <%= 'checked' if @scores.include?(answer.id) %> <%= 'disabled' if @average || @scores.include?(answer.id) %>>
					<% if @average %>
						<strong>
							<span class="badge"><%= '+' if answer.value > 0 %><%= answer.value %></span>
						</strong>
					<% end %>
					<%= answer.body.sub /\w[.]/, '' %>
				</label>
				<blockquote style="<%= hidden unless @average || @scores.include?(answer.id) %>" class="<%= style if (@average && @scores.include?(answer.id)) || answer.required? %>" id="response-<%= answer.id %>">
					<%= markdown answer.response %>
				</blockquote>
				<% end %>
			</form>
			<%= markdown question.notes if @average && question.notes %>
		</div>
		<% end %>
	</div>
</div>

	<% else %>

<%= markdown @scenario.body %>

	<hr />
	
<% @questions.each do |question| %>
	<div class="question" id="question-<%= question.position %>" style="<%= hidden unless @average || question.position == 1 %>">
		<p><strong><%= question.position %>. <%= question.body %></strong></p>
		
		<% answers = @answers.find_all {|a| a.question_id == question.id } %>

		<form>
			<% answers.each do |answer| %>
				<%
					if answer.value > 0
						style = 'correct'
					elsif answer.value < 0
						style = 'incorrect'
					elsif answer.value == 0
						style = 'neutral'
					else
						style = ''
					end
				%>
				
				<label class="checkbox <%= style if @average && @scores.include?(answer.id) %>">
					<input type="checkbox" class="<%= 'required' if answer.required? %>" id="<%= answer.id %>" name="<%= answer.id %>" <%= 'checked' if @scores.include?(answer.id) %> <%= 'disabled' if @average || @scores.include?(answer.id) %>>
					<% if @average %>
						<strong>
							<span class="badge"><%= '+' if answer.value > 0 %><%= answer.value %></span>
						</strong>
					<% end %>
					<%= answer.body.sub /\w[.]/, '' %>
				</label>
				<blockquote style="<%= hidden unless @average || @scores.include?(answer.id) %>" class="<%= style if (@average && @scores.include?(answer.id)) || answer.required? %>" id="response-<%= answer.id %>">
					<%= markdown answer.response %>
				</blockquote>
			<% end %>
		</form>
		
		<%= markdown question.notes if @average && question.notes %>
		
	</div>

<% end %>

<% unless @average %>
<div class="pagination pagination-centered">
	<p><small>Questions:</small></p>
	<ul>
		<li class="active"><a class="question-link" href="#question1">1</a></li>
		<% @questions.each do |question| %>
			<% if question.position > 1 %>
				<li class="disabled"><a class="question-link" href="#question<%= question.position %>"><%= question.position %></a></li>
			<% end %>
		<% end %>
		<li class="disabled"><a href="/ceu/scenarios/<%= @scenario.id %>/score" id="score-link">Show Score</a></li>
	</ul>
</div>
<% end %>

<% end %>
