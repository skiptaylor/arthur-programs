<div class="row">

	<div class="span3">
		<%= erb :'admin/navigation', layout: false %>
	</div>

	<div class="span9">
		<ul class="breadcrumb">
			<li>Admin <span class="divider">/</span></li>
			<li><a href="/admin/users">Users</a> <span class="divider">/</span></li>
			<li class="active"><%= @user.name %></li>
		</ul>
		
		<div class="page-header">
			<% if @user.id %>
				<a href="/admin/users/<%= @user.id %>/delete" class="btn btn-danger" style="float: right;">Delete This User</a>
			<% end %>
			<h2>
				<% if @user.name %>
					<%= @user.name %>
				<% else %>
					New User
				<% end %>
			</h2>
		</div>
		
		<form class="form-horizontal" method="post">
			
			<div class="control-group" id="name-group">
				<label class="control-label" for="name">Name</label>
				<div class="controls">
					<input type="text" class="input-xlarge" id="name" name="name" value="<%= @user.name %>">
				</div>
			</div>
			
			<div class="control-group">
				<div class="controls">
					<label class="checkbox">
						<input type="checkbox" name="admin" id="admin" <%= 'checked' if @user.admin? %> /> Admin
					</label>
				</div>
			</div>
			
			<div class="control-group" id="email-group">
				<label class="control-label" for="email">Email address</label>
				<div class="controls">
					<input type="text" class="input-xlarge" id="email" name="email" value="<%= @user.email %>">
				</div>
			</div>

			<div class="control-group" id="phone-group">
				<label class="control-label" for="phone">Phone number</label>
				<div class="controls">
					<input type="text" class="input-xlarge" id="phone" name="phone" value="<%= @user.phone %>">
				</div>
			</div>

			<div class="control-group" id="password-group">
				<label class="control-label" for="password">New password</label>
				<div class="controls">
					<input type="text" class="input-xlarge" id="password" name="password">
					<span class="help-inline">This will override the existing password.</span>
				</div>
			</div>
			
			<div class="control-group" id="exams-group">
				<label class="control-label" for="max_exams">NCE exams</label>
				<div class="controls">
					<input type="text" class="input-small" id="max_exams" name="max_exams" value="<%= @user.max_exams %>">
				</div>
			</div>
			
			<div class="control-group" id="nce-downloads-group">
				<label class="control-label" for="nce_downloads">NCE Downloads</label>
				<div class="controls">
					<input type="checkbox" name="nce_downloads" id="nce_downloads" <%= 'checked' if @user.nce_downloads %> />
				</div>
			</div>
			
			<div class="control-group" id="scenarios-group">
				<label class="control-label" for="max_scenarios">NCMHCE scenarios</label>
				<div class="controls">
					<input type="text" class="input-small" id="max_scenarios" name="max_scenarios" value="<%= @user.max_scenarios %>">
				</div>
			</div>

			<div class="control-group" id="ncmhce-downloads-group">
				<label class="control-label" for="ncmhce_downloads">NCMHCE Downloads</label>
				<div class="controls">
					<input type="checkbox" name="ncmhce_downloads" id="ncmhce_downloads" <%= 'checked' if @user.ncmhce_downloads %> />
				</div>
			</div>

			<div class="control-group" id="workshop-scenarios-group">
				<label class="control-label" for="workshop_scenarios">Workshop Scenarios</label>
				<div class="controls">
					<input type="checkbox" name="workshop_scenarios" id="workshop_scenarios" <%= 'checked' if @user.workshop_scenarios %> />
				</div>
			</div>

			<div class="control-group" id="expiration-group">
				<label class="control-label" for="expiration_date">Expires</label>
				<div class="controls">
					<%= @user.expiration_date.to_fields 'expiration' %>
					<span class="help-inline">Doesn't apply to admin accounts.</span>
				</div>
			</div>
						
			<div class="control-group" id="refund-request-date-group">
				<label class="control-label" for="refund_request_date">Refund Request Date</label>
				<div class="controls">
					<% if @user.refund_request_date.nil? %>
						<%= Date.new.to_fields 'refund_request' %>
					<% else %>
						<%= @user.refund_request_date.to_fields 'refund_request' %>
					<% end %>
				</div>
			</div>

			<div class="control-group" id="refund-check-date-group">
				<label class="control-label" for="refund_check_date">Refund Check Date</label>
				<div class="controls">
					<% if @user.refund_check_date.nil? %>
						<%= Date.new.to_fields 'refund_check' %>
					<% else %>
						<%= @user.refund_check_date.to_fields 'refund_check' %>
					<% end %>
				</div>
			</div>

			<div class="control-group" id="notes-group">
				<label class="control-label" for="notes">Notes</label>
				<div class="controls">
					<textarea name="notes" id="notes" class="input-xlarge" rows="7"><%= @user.notes %></textarea>
				</div>
			</div>
						
			<div class="control-group">
				<div class="controls">
					<input type="submit" class="btn btn-primary" value="<%= @user.id ? 'Update' : 'Create' %>" />
				</div>
			</div>
			
		</form>
		
		<br />
		
		<div class="page-header">
			<h2>Purchases</h2>
		</div>
		
		<table class="table table-condensed">
			<thead>
				<tr>
					<th>Date</th>
					<th>Amount</th>
					<th>Item</th>
					<th>Stripe ID</th>
					<th>User</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<% @user.purchases.each do |purchase| %>
					<tr>
						<td><%= purchase.created_at.display :american_day %></td>
						<td><%= purchase.amount.dollarize %></td>
						<td>
							<%= purchase.package %>
							<br />
							<span style="font-size: 90%;"><%= purchase.options %></span>
						</td>
						<td><a href="https://manage.stripe.com/#payments/<%= purchase.stripe_id %>" target="_blank"><%= purchase.stripe_id %></a></td>
						<td><a href="/admin/users/<%= purchase.user.id %>"><%= purchase.user.email %></a></td>
						<td style="text-align: right;">
							<%= '<span class="label label-warning">To Be Shipped</span>' if purchase.needs_shipping? %>
							<a href="/admin/purchases/<%= purchase.id %>" class="btn btn-mini btn-info"><i class="icon icon-edit icon-white"></i></a>
						</td>
					</tr>
				<% end %>
			</tbody>
		</table>
		
		<br />
		
		<div class="page-header">
			<h2>Scores</h2>
		</div>
		
		<table class="table table-condensed">
			<thead>
				<tr>
					<th>Score</th>
					<th>Scenario</th>
					<th>Exam</th>
				</tr>
			</thead>
			<tbody>
				<% @user.averages.each do |avg| %>
					<tr>
						<td><%= avg.score %>%</td>
						<td><%= avg.scenario_id %></td>
						<td><%= avg.exam_id %></td>
					</tr>
				<% end %>
			</tbody>
		</table>


	</div>

</div>