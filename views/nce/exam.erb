<script src="/js/exam.js"></script>

<ul class="breadcrumb">
	<li>NCE <span class="divider">/</span></li>
	<li><a href="/nce/exams">Exams</a> <span class="divider">/</span></li>
	<li class="active"><%= @exam.title %></li>
</ul>
	
<div class="page-header">
	<h1>
		<%= @exam.title %>
		<small class="darker-gray">
			<% if params[:group] %>
				<%= params[:group] %>
			<% else %>
				Part <span id="set-label">1</span> of 10
			<% end %>
		</small>
	</h1>
</div>

<% if @average %>
	<div class="well">
		<div class="row">
			<div class="span11">
				<h3>
					Your Score: <%= @average %>% &nbsp;
					<% if @exam.group_average %>
						<small class="darker-gray">Average score of all users to date: <strong><%= @exam.group_average %>%</strong></small>
					<% end %>
				</h3>
				<%
					style = 'progress-danger'
					style = 'progress-warning' if @average > 60
					style = 'progress-success' if @average > 80
				%>
				<div class="progress <%= style %>">
					<div class="bar" style="width: <%= @average %>%;"></div>
				</div>
			</div>
		</div>

		<div class="row">			
			<%= erb :progressbar, layout: false, locals: { label: 'Professional Orientation', correct: @breakdown['Professional Orientation'][:correct], possible: @breakdown['Professional Orientation'][:possible] } %>			
			<%= erb :progressbar, layout: false, locals: { offset: true, label: 'Research and Program Evaluation', correct: @breakdown['Research and Program Evaluation'][:correct], possible: @breakdown['Research and Program Evaluation'][:possible] } %>			

			<%= erb :progressbar, layout: false, locals: { label: 'Appraisal', correct: @breakdown['Appraisal'][:correct], possible: @breakdown['Appraisal'][:possible] } %>			
			<%= erb :progressbar, layout: false, locals: { offset: true, label: 'Lifestyle and Career Development', correct: @breakdown['Lifestyle and Career Development'][:correct], possible: @breakdown['Lifestyle and Career Development'][:possible] } %>			

			<%= erb :progressbar, layout: false, locals: { label: 'Helping Relationships', correct: @breakdown['Helping Relationships'][:correct], possible: @breakdown['Helping Relationships'][:possible] } %>			
			<%= erb :progressbar, layout: false, locals: { offset: true, label: 'Group Counseling', correct: @breakdown['Group Counseling'][:correct], possible: @breakdown['Group Counseling'][:possible] } %>						

			<%= erb :progressbar, layout: false, locals: { label: 'Human Growth and Development', correct: @breakdown['Human Growth and Development'][:correct], possible: @breakdown['Human Growth and Development'][:possible] } %>			
			<%= erb :progressbar, layout: false, locals: { offset: true, label: 'Social and Cultural Foundations', correct: @breakdown['Social and Cultural Foundations'][:correct], possible: @breakdown['Social and Cultural Foundations'][:possible] } %>			
		</div>
		<br />
		<a href="/nce/exams/<%= params[:id] %>/restart" class="btn restart">Start Over</a> &nbsp; <a href="/nce/exams" class="btn">Exams</a>
		<br /><br />
		<strong>
			<span style="color: #666666; font-size: 90%;">COLOR CODE:</span> &nbsp; 
			<span style="color: green;"><i class="icon-ok"></i> Correct</span>, &nbsp; 
			<span style="color: red;">Incorrect</span>
		</strong>
	</div>
	<hr />
<% end %>

<% @questions.each do |question| %>
	<% notes = nil %>

	<%=
		if params[:group]
			puts '<div>'
		else
			case question.position
			when 1
				'<div class="set" id="set-1">'
			when 21
				'<div class="set" id="set-2" style="display: none;">'
			when 41
				'<div class="set" id="set-3" style="display: none;">'
			when 61
				'<div class="set" id="set-4" style="display: none;">'
			when 81
				'<div class="set" id="set-5" style="display: none;">'
			when 101
				'<div class="set" id="set-6" style="display: none;">'
			when 121
				'<div class="set" id="set-7" style="display: none;">'
			when 141
				'<div class="set" id="set-8" style="display: none;">'
			when 161
				'<div class="set" id="set-9" style="display: none;">'
			when 181
				'<div class="set" id="set-10" style="display: none;">'
			end
		end
	%>
	
	<%
		read = false
		answers = []
		@answers.each {|a| answers << a if a.question_id == question.id}
		answers.each {|a| read = true if @scores.include? a.id }
	%>
	
	<p <%= 'class="unread"' unless @average || read %>>
		<%= question.position %>. <%= question.body %>
	</p>

	<form>
		<div class="row">
			<% answers.each do |answer| %>
				<% notes = answer.response if @average && answer.required? %>
				<div class="span12">
					<%
						if @average && @scores.include?(answer.id) && answer.required?
							style = 'color: green; font-weight: bold;'
						elsif @average && @scores.include?(answer.id) && !answer.required?
							style = 'color: red; font-weight: bold;'
						else
							style = 'color: inheret;'
						end
					%>
					<label class="radio" style="<%= style %>">
						<%= '<i class="icon-ok"></i>' if answer.required? && @average %>
						<input type="radio" name="<%= question.id %>" value="<%= answer.id %>" <%= 'checked' if @scores.include? answer.id %> <%= 'disabled' if @average %> /> <%= answer.body %>
					</label>
				</div>
			<% end %>
		</div>
	</form>
	
	<%= "<blockquote><p>#{notes}</p></blockquote>" if notes %>	
	
	<hr />
	<%= '</div>' if ([20, 40, 60, 80, 100, 120, 140, 160, 180, 200].include? question.position) && !params[:group] %>

<% end %>

<% if params[:group] %>
	</div>
	
	<p style="text-align: center;">
		<a href="/nce/exams/<%= @exam.id %>/score" class="btn btn-primary">Show Score</a>
	</p>
<% else %>
	<div class="pagination pagination-centered">
		<ul>
			<li class="active"><a class="set-link" href="#part1">1</a></li>
			<li><a class="set-link" href="#part2">2</a></li>
			<li><a class="set-link" href="#part3">3</a></li>
			<li><a class="set-link" href="#part4">4</a></li>
			<li><a class="set-link" href="#part5">5</a></li>
			<li><a class="set-link" href="#part6">6</a></li>
			<li><a class="set-link" href="#part7">7</a></li>
			<li><a class="set-link" href="#part8">8</a></li>
			<li><a class="set-link" href="#part9">9</a></li>
			<li><a class="set-link" href="#part10">10</a></li>
			<% unless @average %>
				<li><a href="/nce/exams/<%= @exam.id %>/score" id="score-link">Show Score</a></li>
			<% end %>
		</ul>
	</div>
<% end %>