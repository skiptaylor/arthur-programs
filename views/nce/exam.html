<%= coffee 'exam' %>

<ul class="breadcrumb">
	<li>NCE <span class="divider">/</span></li>
	<li><a href="/nce/exams">Exams</a> <span class="divider">/</span></li>
	<li class="active"><%= @exam.title %></li>
</ul>

	
<div class="page-header">
	<h1>
		<%= @exam.title %>
		<small>Part <span id="set-label">1</span> of 10</small>
	</h1>
</div>

<% if @average %>
	<div class="well">
		<h3>
			Your Score: <%= @average %>%
			<small>Average Score: <%= @exam.group_average %>%</small>
		</h3>
		<br />
		<div class="row">
			<div class="span5">
				Professional Orientation:
				<%= @breakdown['Professional Orientation'][:correct] %> / <%= @breakdown['Professional Orientation'][:possible] %>
			</div>
			<div class="span5">
				Research and Program Evaluation:
				<%= @breakdown['Research and Program Evaluation'][:correct] %> / <%= @breakdown['Research and Program Evaluation'][:possible] %>
			</div>
			<div class="span5">
				Appraisal:
				<%= @breakdown['Appraisal'][:correct] %> / <%= @breakdown['Appraisal'][:possible] %>
			</div>
			<div class="span5">
				Lifestyle and Career Development:
				<%= @breakdown['Lifestyle and Career Development'][:correct] %> / <%= @breakdown['Lifestyle and Career Development'][:possible] %>
			</div>
			<div class="span5">
				Helping Relationships:
				<%= @breakdown['Helping Relationships'][:correct] %> / <%= @breakdown['Helping Relationships'][:possible] %>
			</div>
			<div class="span5">
				Group Counseling:
				<%= @breakdown['Group Counseling'][:correct] %> / <%= @breakdown['Group Counseling'][:possible] %>
			</div>
			<div class="span5">
				Human Growth and Development:
				<%= @breakdown['Human Growth and Development'][:correct] %> / <%= @breakdown['Human Growth and Development'][:possible] %>
			</div>
			<div class="span5">
				Social and Cultural Foundations:
				<%= @breakdown['Social and Cultural Foundations'][:correct] %> / <%= @breakdown['Social and Cultural Foundations'][:possible] %>
			</div>
		</div>
		<br />
		<a href="/nce/exams/<%= params[:id] %>/restart" class="btn restart">Start Over</a>
		<br /><br />
		<strong>
			<span style="color: silver; font-size: 90%;">COLOR CODE:</span>
			<span style="color: green;">Correct</span>,
			<span style="color: red;">Incorrect</span>
		</strong>
	</div>
	<hr />
<% end %>

<% @questions.each do |question| %>
	<% notes = nil %>

	<%= '<div class="set" id="set-1">'  if question.position == 1 %>
	<%= '<div class="set" id="set-2" style="display: none;">'  if question.position == 21 %>
	<%= '<div class="set" id="set-3" style="display: none;">'  if question.position == 41 %>
	<%= '<div class="set" id="set-4" style="display: none;">'  if question.position == 61 %>
	<%= '<div class="set" id="set-5" style="display: none;">'  if question.position == 81 %>
	<%= '<div class="set" id="set-6" style="display: none;">'  if question.position == 101 %>
	<%= '<div class="set" id="set-7" style="display: none;">'  if question.position == 121 %>
	<%= '<div class="set" id="set-8" style="display: none;">'  if question.position == 141 %>
	<%= '<div class="set" id="set-9" style="display: none;">'  if question.position == 161 %>
	<%= '<div class="set" id="set-10" style="display: none;">' if question.position == 181 %>
	
	<%
		read = false
		answers = []
		@answers.each {|a| answers << a if a.question_id == question.id}
		answers.each {|a| read = true if @scores.include? a.id }
	%>
	
	<p <%= 'class="unread"' unless @average || read %>>
		<%= question.position %>. <%= question.body %>
	</p>

	<form>
		<div class="row">
			<% answers.each do |answer| %>
				<% notes = answer.response if @average && answer.required? %>
				<div class="span6">
					<%
						if @average && @scores.include?(answer.id) && answer.required?
							style = 'color: green; font-weight: bold;'
						elsif @average && @scores.include?(answer.id) && !answer.required?
							style = 'color: red; font-weight: bold;'
						else
							style = 'color: inheret;'
						end
					%>
					<label class="radio" style="<%= style %>">
						<input type="radio" name="<%= question.id %>" value="<%= answer.id %>" <%= 'checked' if @scores.include? answer.id %> <%= 'disabled' if @average %> /> <%= answer.body %>
						<%= '<i class="icon-ok"></i>' if answer.required? && @average %>
					</label>
				</div>
			<% end %>
		</div>
	</form>
	
	<%= "<blockquote><p>#{notes}</p></blockquote>" if notes %>	
	
	<hr />
	<%= '</div>' if [20, 40, 60, 80, 100, 120, 140, 160, 180, 200].include? question.position %>

<% end %>

<div class="pagination pagination-centered">
	<ul>
		<li class="active"><a class="set-link" href="#part1">1</a></li>
		<li><a class="set-link" href="#part2">2</a></li>
		<li><a class="set-link" href="#part3">3</a></li>
		<li><a class="set-link" href="#part4">4</a></li>
		<li><a class="set-link" href="#part5">5</a></li>
		<li><a class="set-link" href="#part6">6</a></li>
		<li><a class="set-link" href="#part7">7</a></li>
		<li><a class="set-link" href="#part8">8</a></li>
		<li><a class="set-link" href="#part9">9</a></li>
		<li><a class="set-link" href="#part10">10</a></li>
		<% unless @average %>
			<li class="disabled"><a href="/nce/exams/<%= @exam.id %>/score" id="score-link">Show Score</a></li>
		<% end %>
	</ul>
</div>
